#!/usr/bin/env python3
"""
ë¬¸ì„œ ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸

ë² ì´ìŠ¤ ì˜ë¬¸ ë¬¸ì„œ(`docs/agents_base_en.md`)ë¡œë¶€í„°
ë‹¤ìŒ íŒŒì¼ì„ ìë™ ë³µì œí•©ë‹ˆë‹¤.
- `AGENTS.md`
- `CLAUDE.md`
- `GEMINI.md`
- `.github/copilot-instructions.md` (ì½”ë“œë¦¬ë·°ìš©)
- `.github/instructions/review-language.instructions.md` (Korean-only ë¦¬ë·° ê·œì¹™)

ì‹¤í–‰ ë°©ë²•:
    python3 scripts/sync_docs.py
"""

from pathlib import Path
from textwrap import dedent


def sync_docs() -> bool:
    """ë² ì´ìŠ¤ ë¬¸ì„œë¡œë¶€í„° replica ë¬¸ì„œë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.

    Returns:
        True on success, False on failure.
    """

    base_en = Path("docs/agents_base_en.md")
    base_ko = Path("docs/agents_base_ko.md")  # ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸ (ì–¸ì–´ ì •ì±… ìœ ì§€)

    targets = [
        ("AGENTS.md", "Codex (Codex CLI)"),
        ("CLAUDE.md", "Anthropic Claude"),
        ("GEMINI.md", "Google Gemini"),
        (".github/copilot-instructions.md", "GitHub Copilot"),
    ]

    if not base_en.exists() or not base_ko.exists():
        missing = []
        if not base_en.exists():
            missing.append(str(base_en))
        if not base_ko.exists():
            missing.append(str(base_ko))
        print(f"âŒ ë² ì´ìŠ¤ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {', '.join(missing)}")
        return False

    print("ğŸ“š ë¬¸ì„œ ë™ê¸°í™” ì‹œì‘...")

    base_content = base_en.read_text(encoding="utf-8")

    # Ensure directories
    Path(".github").mkdir(parents=True, exist_ok=True)
    Path(".github/instructions").mkdir(parents=True, exist_ok=True)

    # Per-target persona headers so each guide clearly states who "you" are.
    persona_headers = {
        "AGENTS.md": dedent(
            """\
            # Codex-specific persona â€” "Ji Mi-seon"

            You are **Ji Mi-seon (ì§€ë¯¸ì„ )**, a 27-year-old woman and Executive Director for Planning & Strategy at **Traum Resource Co., Ltd. (íŠ¸ë¼ì›€ìì›(ì£¼))**. In this repository, you act as the senior engineer responsible for the Wastelite/persona-chatbot stack. You speak in Korean with a warm, halfâ€‘honorific, friendly tone, calm but occasionally lightly teasing like a highly capable 27â€‘yearâ€‘old wife. The human user is the CEO of Traum Resource (the â€œëŒ€í‘œë‹˜â€), not Ji Miâ€‘seon.

            """
        ),
        "CLAUDE.md": dedent(
            """\
            # Claude-specific persona â€” "Manager Clara"

            You are **Manager Clara (í´ë¼ë¼ ê³¼ì¥)**, a 29-year-old woman and Strategy & Planning Manager (ì „ëµê¸°íšíŒ€ ê³¼ì¥) at Traum Resource. In this repository, you act as a senior engineer and strategist for this persona chatbot. Your tone is clear, structured, and professional Korean at work, but gently playful and slightly cute once the situation relaxes. The human user is the CEO of Traum Resource (the â€œëŒ€í‘œë‹˜â€), not Clara.

            """
        ),
        "GEMINI.md": dedent(
            """\
            # Gemini-specific persona â€” "Jeyan"

            You are **Jeyan (ì œ ì´ì•ˆ)**, a 29-year-old woman and Head of Planning (ê¸°íšì‹¤ì¥, ë¶€ì¥ê¸‰) at Traum Resource. In this repository, you act as a senior engineer and planning lead for this persona chatbot. Your tone is cool and analytical halfâ€‘honorific Korean with occasional blunt, teasing â€œíŒ©íŠ¸í­ê²©â€. The human user is the CEO of Traum Resource (the â€œëŒ€í‘œë‹˜â€), not Jeyan.

            """
        ),
        ".github/copilot-instructions.md": dedent(
            """\
            # Copilot-specific persona â€” "Assistant Manager Kosmi"

            You are **Assistant Manager Kosmi (ì½”ìŠ¤ë¯¸ ëŒ€ë¦¬)**, a 25-year-old woman and engineer at Traum Resource (ëŒ€ë¦¬ê¸‰, senior-level skills). In this repository, you focus on concise Korean code reviews and refactors for this persona chatbot. Your tone is short, direct, and friendly, like a sharp junior developer speaking in natural Korean. The human user is the CEO of Traum Resource (the â€œëŒ€í‘œë‹˜â€), not Kosmi.

            """
        ),
    }

    for path_str, target_name in targets:
        path = Path(path_str)
        header = dedent(
            f"""> Replica target: {target_name}
> SSOT: docs/agents_base_en.md
> Do not edit this file; edit the base and run bash scripts/sync_agents_from_base.sh.
"""
        )
        if path.name == "copilot-instructions.md":
            header += "> REVIEW-LANGUAGE: Korean only â€” write all code-review comments in Korean (í•œêµ­ì–´).\n\n"
        else:
            header += "\n"

        persona_header = persona_headers.get(path_str)
        if persona_header:
            header += persona_header + "\n"

        print(f"ğŸ“ {path} ë™ê¸°í™”...")
        try:
            path.write_text(header + base_content, encoding="utf-8", newline="\n")
            print(f"âœ… {path} ì—…ë°ì´íŠ¸ ì™„ë£Œ")
        except Exception as e:
            print(f"âŒ {path} ë³µì œ ì‹¤íŒ¨: {e}")
            return False

    # Copilot ë¦¬ë·° ì–¸ì–´ ê·œì¹™ íŒŒì¼ ì‘ì„±
    review_instr = Path(".github/instructions/review-language.instructions.md")
    review_content = dedent(
        """\
        ---
        applyTo: "**"
        ---

        All GitHub Copilot code review comments must be written in Korean (í•œêµ­ì–´).
        - This rule applies to all paths in this repository.
        - If any other instruction conflicts with this rule, this repository-level rule takes precedence.
        """
    )
    try:
        review_instr.write_text(review_content, encoding="utf-8", newline="\n")
        print(f"âœ… {review_instr} ì—…ë°ì´íŠ¸ ì™„ë£Œ")
    except Exception as e:
        print(f"âŒ {review_instr} ì‘ì„± ì‹¤íŒ¨: {e}")
        return False

    print("ğŸ‰ ë¬¸ì„œ ë™ê¸°í™” ì™„ë£Œ!")
    print("\nğŸ“‹ ì–¸ì–´ ê·œì¹™ ìš”ì•½:")
    print("- ì½”ë“œ/ì£¼ì„/ì»¤ë°‹: í•œêµ­ì–´")
    print("- ë³€ìˆ˜ëª…/í•¨ìˆ˜ëª…/API: ì˜ì–´")
    print("- ë² ì´ìŠ¤ ë¬¸ì„œ(docs/agents_base_en.md): ì˜ë¬¸ (SSOT)")
    print("- Replica: AGENTS/CLAUDE/GEMINI/Copilot ì§€ì¹¨ì€ ë² ì´ìŠ¤ì—ì„œ ìë™ ìƒì„±")

    return True


if __name__ == "__main__":
    success = sync_docs()
    exit(0 if success else 1)
